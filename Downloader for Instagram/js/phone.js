!function(){function a(a){l.css({"border-color":a}),["#35383D","#000000","#873239","#28B3D4","#A7A7A7"].indexOf(a)>-1?n.css({color:"#fff"}):n.css({color:"#000"}),window.localStorage.color=a}function b(a){"phone"==a?(l.css({width:"340px","max-height":"650px","border-width":"28px 7px 50px"}),m.css({width:"340px"}),n.text("instaPhone"),k="phone"):"tablet"==a&&(l.css({width:"800px","max-height":"600px","border-width":"28px 24px 50px"}),m.css({width:"800px"}),o.get(0).checked=!0,n.text("instaPad"),k="tablet"),window.localStorage.device=a}function c(){$(".insta_loading .text").text((chrome.i18n.getMessage("loading")||"Loading")+"...")}function d(){$(".color").on("click",function(b){a(this.dataset.color)}),o.on("change",function(){b(this.checked?"tablet":"phone")}),$(".arrow_left").on("click",function(a){window.history.back()}),$(".arrow_right").on("click",function(a){window.history.forward()})}function e(){var a=document.createElement("iframe"),b=document.querySelector("#iframe_wrap");a.setAttribute("src","https://www.instagram.com/"),a.setAttribute("frameborder","0"),b.appendChild(a),$(a).on("load",function(){$(".insta_loading").hide()})}function f(a){function b(a){k=!0;var b=this.dataset.pos;i.forEach(function(a){a.dataset.pos<=b?(a.querySelector(".empty").style.display="none",a.querySelector(".filled").style.display="inline"):(a.querySelector(".empty").style.display="inline",a.querySelector(".filled").style.display="none")})}function c(a){e||(k=!1,setTimeout(function(){k||i.forEach(function(a){a.querySelector(".empty").style.display="inline",a.querySelector(".filled").style.display="none"})},100))}function d(a){e=!0;var h=this.dataset.pos;i.forEach(function(a){a.dataset.pos<=h&&(a.querySelector(".empty").style.display="none",a.querySelector(".filled").style.display="inline")}),i.forEach(function(a){a.removeEventListener("mouseover",b),a.removeEventListener("mouseout",c),a.removeEventListener("click",d)}),j.innerText=chrome.i18n.getMessage("your_rate"),chrome.runtime.sendMessage({action:"setPopupRate",value:h}),h>3&&!f&&(f=!0,chrome.tabs.create({url:"https://chrome.google.com/webstore/detail/instagram-downloader/"+chrome.runtime.id+"/reviews"})),g("user_popup_rate",{value:h})}if(!a){var e=!1,f=!1,h=document.querySelector("#rating-ask");h.style.display="inline-block";var i=h.querySelectorAll("#rating-ask .stars a"),j=h.querySelector(".ext_text"),k=!1;i&&i.forEach&&(i.forEach(function(a){a.querySelector(".empty").style.display="inline",a.querySelector(".filled").style.display="none"}),j.innerText=chrome.i18n.getMessage("rate_us_popup"),i.forEach(function(a){a.addEventListener("mouseover",b),a.addEventListener("mouseout",c),a.addEventListener("click",d)}))}}function g(a,b){var c={action:"trackEvent",event:a};"undefined"!=typeof b&&(c.details=JSON.stringify(b)),chrome.runtime.sendMessage(c)}function h(){chrome.runtime.onMessage.addListener(function(a,b,c){return"tryUploadStory"==a?("tablet"==k?(o.click(),c(!0)):c(),!0):void("checkConnect"==a?c(!0):"needReloadPage"==a&&window.location.reload())})}function i(a){if(!a){var b=$(".add_to_bookmarks");b.text(chrome.i18n.getMessage("add_to_bookmarks")),$(".bookmarks_wrap").show(),b.on("click",function(){chrome.runtime.sendMessage("addPhone2Bookmarks",function(){}),b.hide()})}}chrome.runtime.sendMessage("mobileStateInit",e),chrome.runtime.sendMessage("getPopupRate",f),chrome.runtime.sendMessage("inBookmarks",i);var j=window.localStorage.color||"#E6E7E9",k=window.localStorage.device||"phone",l=$(".phone"),m=$("#iframe_wrap"),n=$(".phone .label .text"),o=$("#deviceswitch");a(j),b(k),c(),d(),h()}();