!function(){function a(a){function b(a){k=!0;var b=this.dataset.pos;i.forEach(function(a){a.dataset.pos<=b?(a.querySelector(".empty").style.display="none",a.querySelector(".filled").style.display="inline"):(a.querySelector(".empty").style.display="inline",a.querySelector(".filled").style.display="none")})}function d(a){f||(k=!1,setTimeout(function(){k||i.forEach(function(a){a.querySelector(".empty").style.display="inline",a.querySelector(".filled").style.display="none"})},100))}function e(a){f=!0;var h=this.dataset.pos;i.forEach(function(a){a.dataset.pos<=h&&(a.querySelector(".empty").style.display="none",a.querySelector(".filled").style.display="inline")}),i.forEach(function(a){a.removeEventListener("mouseover",b),a.removeEventListener("mouseout",d),a.removeEventListener("click",e)}),j.innerText=chrome.i18n.getMessage("your_rate"),chrome.runtime.sendMessage({action:"setPopupRate",value:h}),h>3&&!g?(g=!0,y.trackEvent("user_popup_rate",{value:h}),chrome.tabs.create({url:"https://chrome.google.com/webstore/detail/instagram-downloader/"+chrome.runtime.id+"/reviews"})):c("rate",h)}try{if(a)return;var f=!1,g=!1,h=A.querySelector("#rating-ask");h.style.display="inline-block";var i=h.querySelectorAll("#rating-ask .stars a"),j=h.querySelector(".ext_text"),k=!1;if(!i||!i.forEach)return;i.forEach(function(a){a.querySelector(".empty").style.display="inline",a.querySelector(".filled").style.display="none"}),j.innerText=chrome.i18n.getMessage("rate_us_popup"),i.forEach(function(a){a.addEventListener("mouseover",b),a.addEventListener("mouseout",d),a.addEventListener("click",e)})}catch(l){y.trackCodeError(l,"showPopupRate")}}function b(a,b){var c=a.url,d=a.filename;chrome.downloads.download({url:c,filename:d},function(e){if("undefined"==typeof e){var f=a.filename.match(/([\w_]+)(\.\w{3,4})$/);f=f&&f[0],f?(d=f.substr(f.length-32),chrome.downloads.download({url:c,filename:d},function(a){"undefined"==typeof a&&(y.trackEventWithRandom("reject_download",{filename:d},.05),"function"==typeof b&&b())})):(y.trackEventWithRandom("not_valid_filename_for_download",{filename:d},.05),"function"==typeof b&&b())}else"function"==typeof b&&b(e)})}function c(b,c){function d(a){var b=this.value.length;b>=800&&a.preventDefault(),b>600?(q.style.display="inline-block",s.innerText=800-b):q.style.display="none"}function e(a){return a.preventDefault(),!1}function f(){p.style.display="none",o.classList.remove("error")}function g(a){var b=n.value,d=o.value;if(d&&!d.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))return p.style.display="inline-block",void o.classList.add("error");if(T="",U=!1,k.style.visibility="hidden",k.style.opacity="0",k.style.display="none",i(),j)var e={msg:b,email:d},f="user_report_problem";else e={value:c,msg:b,email:d},f="user_popup_rate";y.trackEvent(f,e)}function h(){T="",U=!1,k.style.visibility="hidden",k.style.opacity="0",k.style.display="none",i(),a(),chrome.runtime.sendMessage({action:"setPopupRate",value:0})}function i(){l.removeEventListener("click",g),m.removeEventListener("click",h),n.removeEventListener("input",d),o.removeEventListener("input",f)}try{var j="report"==b;U=j;var k=document.querySelector(".comment-wrapper");k.style.display="block",k.style.visibility="visible",k.style.opacity="1";var l=k.querySelector(".send_btn"),m=k.querySelector(".cancel_btn"),n=k.querySelector("textarea"),o=k.querySelector("#email_input"),p=k.querySelector(".not_valid_email"),q=k.querySelector(".symbols_left"),r=q.querySelector(".text"),s=q.querySelector(".count");l.innerText=chrome.i18n.getMessage("send").toUpperCase(),m.innerText=chrome.i18n.getMessage("btn_cancel").toUpperCase(),n.placeholder=chrome.i18n.getMessage("write_us")+"...",r.innerText=chrome.i18n.getMessage("symbols_left")+":",p.innerText=chrome.i18n.getMessage("not_valid_email"),o.setAttribute("placeholder",chrome.i18n.getMessage("enter_your_email")),n.value="",l.addEventListener("click",g),m.addEventListener("click",h),n.addEventListener("input",d),n.addEventListener("paste",e),o.addEventListener("input",f)}catch(t){y.trackCodeError(t,"showReportTextArea")}}function d(){var a=document.createElement("div");a.classList.add("download_item");var b=document.createElement("div");b.classList.add("download_item_icon");var c=document.createElement("div");c.classList.add("download_item_overlay"),a.appendChild(c),a.appendChild(b),F=a}function e(){return F||d(),F.cloneNode(!0)}function f(a){return a.shortcode?H.indexOf(a.shortcode)>-1?!1:(H.push(a.shortcode),!0):H.indexOf(a.url)>-1?!1:(H.push(a.url),!0)}function g(){return G?!1:void chrome.tabs.query({active:!0,currentWindow:!0},function(a){a[0].url;chrome.tabs.query({active:!0,currentWindow:!0},function(a){I=a[0];var b=I.id;chrome.tabs.sendMessage(b,"checkLinks")});var b=document.querySelector(".links-no-found");b.innerText=chrome.i18n.getMessage("noLinksFound"),X.hide(),b.style.display="block"})}function h(a){l(),o(a.length),a.forEach(function(a){i(a)&&f(a)&&j(a)})}function i(a){return a?"string"==typeof a.shortcode&&a.shortcode.length?!0:y.isValidUrl(a.url)?!0:!1:!1}function j(a){if(a.isMultiple){var b=q(a),c=0;y.getAllMediaDataFromJsonGraphql({shortCode:a.shortcode},function(a){a.forEach(function(a){c++,2>c||q(a,b)})})}else q(a)}function k(a){f(a)&&(G||l(),j(a))}function l(){try{G=!0,document.querySelector(".links-no-found").style.display="none",B.style.display="none",C.style.display="none",D.style.display="none",document.body.style.width="610px",chrome.runtime.sendMessage("getPopupRate",a);var b=E.querySelector(".icon");E.querySelector(".ext_text").innerText=chrome.i18n.getMessage("report_a_problem"),b.addEventListener("click",function(){U||c("report")}),X.hide(),A.style.display="block",z.style.display="block",n(),$("body").on("click",".download_item",r)}catch(d){y.trackCodeError(d,"linksSuccessFoundState")}}function m(a){if(a){var b=document.querySelector(".upload_wrap"),c=b.querySelector(".upload_icon");c.setAttribute("title",chrome.i18n.getMessage("upload_file")),b.style.display="block",c.addEventListener("click",function(){chrome.tabs.create({url:"https://www.instagram.com/"+a+"#upload"})})}}function n(){var a=document.querySelector(".phone_wrap"),b=a.querySelector(".phone_icon");b.setAttribute("title",chrome.i18n.getMessage("mobile_instagram")),a.style.display="block",b.addEventListener("click",function(){chrome.tabs.create({url:"/phone.html"})})}function o(a){3>a?(J=M,O="big_size",P="/s300x300/"):3==a?(J=L,O="medium_size",P="/s200x200/"):(N=!1,J=K,O="mini_size",P="/s150x150/")}function p(){if(J==L){var a=document.querySelectorAll(".download_item");a&&a.forEach&&a.forEach(function(a){a.classList.remove("big_size"),a.classList.add("medium_size")})}else J==K&&(a=document.querySelectorAll(".download_item"),a&&a.forEach&&a.forEach(function(a){a.classList.remove("big_size","medium_size"),a.classList.add("mini_size")}))}function q(a,b){W++;var c=H.length>W?H.length:W;N&&(o(c),p());var d=t(a),f=e();return f.style.backgroundImage="url("+d+")",f.classList.add(a.type,O),a.isStory&&(f.dataset.isStory=1),a.shortcode&&(f.dataset.shortcode=a.shortcode),a.url&&(f.dataset.url=a.url),a.filename&&(f.dataset.filename=a.filename),"igtv"==a.type&&(f.dataset.igtv="1"),b?$(b).after(f):z.appendChild(f),f}function r(a){var c=Date.now();if(!(R+S>c||Q)){R=c,Q=!0;var d=this;if(this.querySelector(".download_item_icon").classList.add("clicked_now_item"),d.dataset.isStory||!d.dataset.shortcode)b({url:d.dataset.url,filename:d.dataset.filename});else{var e=d.dataset.shortcode;if(!e)return void(Math.random()<.01&&y.trackEvent("not_story_and_no_shortcode_in_popup"));var f=!!d.dataset.igtv;y.getMediaItemFromJsonGraphql({shortCode:e,isIgtv:f},function(a){return(!a||a.error)&&(a=s(d)),a.url&&a.filename?void b({url:a.url,filename:a.filename}):void(Math.random()<.01&&y.trackEvent("not_receive_getReserveMediaDataFromEl"))})}}}function s(a){return a.dataset.url&&a.dataset.filename?{url:a.dataset.url,filename:a.dataset.filename}:null}function t(a){var b=a.prev;return b=b||a.url}function u(){C.querySelector(".message").innerText=chrome.i18n.getMessage("reloadPage"),C.querySelector(".ext_text").innerText=chrome.i18n.getMessage("reloadPageShort"),D.style.display="none",X.hide(),C.style.display="block",document.body.addEventListener("click",function(){chrome.tabs.reload(function(){window.close()})})}function v(a){D.style.display="none",B.querySelector(".instagram_no_msg").innerText=chrome.i18n.getMessage(a);var b=B.querySelector(".instagram_link_wrap a");b.innerText=chrome.i18n.getMessage("go_to_instagram"),setInterval(function(){b.blur()},50),X.hide(),B.style.display="block"}function w(){G||(X.hide(),D.querySelector(".text").innerText=chrome.i18n.getMessage("tab_is_not_complete"),D.querySelector(".loader2").style.display="block",D.style.display="block")}function x(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){try{I=a[0];var b=I.id;if(I.url=="chrome-extension://"+chrome.runtime.id+"/phone.html")return void v("it_is_phone_mode");var c=["chrome://","chrome-search://","https://chrome.google","chrome-extension://"],d=!1;if(c.forEach(function(a){-1!=I.url.indexOf(a)&&(d=!0)}),/^http/.test(I.url)||(d=!0),d)return void v("it_is_not_instagram");chrome.tabs.sendMessage(b,"checkConnect",function(a){a?(chrome.tabs.sendMessage(b,"getFoundLinks",Y),V=-1!==I.url.indexOf("/saved/"),chrome.tabs.sendMessage(b,"getAuthorizedUserName",m)):"complete"!=I.status?(w(),setTimeout(function(){G||x()},500)):-1!=I.url.indexOf("instagram.com")?u():chrome.runtime.sendMessage({action:"pageHasIframe",tabId:b},function(a){a=parseInt(a),"number"==typeof a&&!isNaN(a)&&a>0?u():v("it_is_not_instagram")})})}catch(e){y.trackCodeError(e,"requestActiveTab")}})}var y=window.globalUtils;document.head.setAttribute("lang",chrome.i18n.getMessage("lang"));var z=document.querySelector("#download_item_container"),A=document.querySelector("header#header"),B=(A.querySelector("#logo"),document.querySelector(".it_is_not_instagram")),C=document.querySelector(".install_now"),D=document.querySelector(".tab_is_not_complete"),E=document.querySelector(".report_ask"),F=null,G=!1,H=[],I=null,J=null,K=1,L=2,M=3,N=!0,O=null,P=null,Q=!1,R=0,S=1e3,T="",U=!1,V=!1,W=0,X=function(){var a=document.querySelector(".loader");return a.show=function(){this.style.display="block"},a.hide=function(){this.style.display="none"},a}();chrome.runtime.onMessage.addListener(function(a,b,c){a&&("checkPopupOpened"==a&&c(!0),"object"==typeof a&&a.action&&"linkFound"==a.action&&a.mediaInfo&&b.tab.id==I.id&&k(a.mediaInfo))}),chrome.downloads.onCreated.addListener(function(a){document.querySelector(".clicked_now_item").classList.remove("clicked_now_item"),Q=!1});var Y=function(a){return setTimeout(g,2e3),a&&Array.isArray(a)&&a.length?(G=!0,void h(a)):!1},Z=function(){X.show(),y.fixForeach(),x()};Z(),function(){document.body.style.opacity=0,document.body.style.transition="opacity ease-out .4s",requestAnimationFrame(function(){document.body.style.opacity=1});var a=function(){document.body.style.border="none",setTimeout(function(){document.body.style.border="1px solid transparent"},100),setTimeout(function(){document.body.style.border="none"},300)},b=function(b){setTimeout(function(){var b=document.outerWidth||window.outerWidth;100>b&&a()},b)};a(),b(600),b(1500),b(3e3),b(1e4)}()}();